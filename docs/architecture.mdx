# CyberAi Architecture

## Overview

CyberAi is a **GitHub-native control plane** that serves as the central coordination point for the CyberAi ecosystem. It is NOT an abstract SaaS platform—it's a repository-first, GitHub Pages-powered infrastructure.

## High-Level Role

This repository (`SolanaRemix/CyberAi`) functions as:

1. **Source of Truth for cyberai.network**
   - GitHub Pages site serving documentation, contracts, and operator UI
   - Deployed from `main` branch via automated workflows
   - Custom domain: cyberai.network

2. **Operator Control Plane**
   - Central registry for agents, runners, and repositories
   - Automated workflows for validation and deployment
   - Tools for bootstrapping and auditing the ecosystem

3. **Contract + Prompt Registry**
   - Machine-readable contracts consumed by SmartBrain runners, agents, and other ecosystem components
   - Operator-grade prompts that agents execute
   - Version-controlled and schema-validated

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                      GitHub Repository                       │
│                   SolanaRemix/CyberAi                       │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │  /contracts  │  │   /prompts   │  │    /tools    │    │
│  │              │  │              │  │              │    │
│  │ • agents/    │  │ • agents/    │  │ • bootstrap/ │    │
│  │ • repositories/ │ │ • operators/ │  │ • audit/     │    │
│  │ • schema     │  │ • systems/   │  │              │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │    /site     │  │    /docs     │  │ .github/     │    │
│  │              │  │              │  │  workflows/  │    │
│  │ • Astro app  │  │ • operators/ │  │              │    │
│  │ • src/pages/ │  │ • ecosystem/ │  │ • ci.yml     │    │
│  │ • docs/      │  │              │  │ • pages.yml  │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ GitHub Actions
                            │ GitHub Pages
                            ▼
              ┌──────────────────────────┐
              │   cyberai.network        │
              │   (GitHub Pages)         │
              │                          │
              │  • Documentation         │
              │  • Operator Console      │
              │  • Ecosystem Map         │
              └──────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
            ▼               ▼               ▼
    ┌──────────────┐ ┌────────────┐ ┌──────────────┐
    │  SmartBrain  │ │  Copilot   │ │ GitAntivirus │
    │   Runners    │ │   Agents   │ │    Audits    │
    │              │ │            │ │              │
    │ Consume      │ │ Execute    │ │ Scan repos   │
    │ contracts    │ │ prompts    │ │ & contracts  │
    └──────────────┘ └────────────┘ └──────────────┘
```

## Component Details

### 1. Contracts (`/contracts`)

Machine-readable JSON contracts defining capabilities and requirements.

**Structure:**
```
contracts/
├── contract.schema.json       # JSON Schema for validation
├── agents/                    # AI agent contracts
│   ├── copilot-core.json
│   └── terminal-mobile.json
└── repos/                     # Repository contracts
    ├── smartbrain.json
    └── gitantivirus.json
```

**Schema Elements:**
- `version`: Semantic version
- `type`: agent | repository | runner
- `metadata`: Name, description, owner, tags
- `capabilities`: Actions, endpoints, workflows
- `requirements`: Runtime, dependencies, permissions
- `compliance`: Security audit status

**Validation:**
- Automated via `contracts-validate.yml` workflow
- Local validation: `ajv validate -s contracts/contract.schema.json -d "contracts/**/*.json" --strict=false`
- Fails PR if contracts invalid

### 2. Prompts (`/prompts`)

Operator-grade prompts that agents execute directly from the repository.

**Structure:**
```
prompts/
├── agents/                    # Agent-specific prompts
│   ├── copilot-core/
│   │   ├── bootstrap.md      # Bootstrap fresh clone
│   │   └── repair.md         # Repair failing CI
│   └── terminal-mobile/
│       └── local-bootstrap.md
└── systems/                   # System-level prompts
    └── incident-response.md
```

**Prompt Format:**
- Markdown documents with clear sections
- Input parameters defined
- Expected outputs documented
- Non-goals specified
- References to specific directories and files

**Usage:**
- Agents load prompts via GitHub API or local clone
- Prompts reference contracts and tools
- Version controlled for consistency

### 3. Tools (`/tools`)

POSIX shell scripts for bootstrapping and auditing.

**Bootstrap (`/tools/bootstrap/bootstrap.sh`):**
1. Verify Node.js 18+
2. Install dependencies
3. Validate contracts
4. Build site
5. Report status

**Audit (`/tools/audit/audit.sh`):**
1. Validate contracts against schema
2. Check workflow integrity
3. Verify repository structure
4. Scan for security issues
5. Validate site build

**Configuration:**
- `bootstrap.config.example.json` for custom settings
- Environment variables for overrides
- POSIX compatible (no Bash-specific features)

### 4. Site (`/site`)

Static site built with Astro, deployed to GitHub Pages.

**Structure:**
```
site/
├── astro.config.mjs          # Astro configuration
├── package.json              # Dependencies
└── src/
    ├── pages/                # File-based routing
    │   ├── index.astro      # Landing page
    │   ├── operators/       # Operator console
    │   └── ecosystem/       # Ecosystem map
    ├── layouts/             # Page layouts
    └── components/          # Reusable components
```

**Routes:**
- `/` - Landing page
- `/operators` - Operator console (runbooks, bootstrap, repos)
- `/ecosystem` - Visual map of CyberAi repos
- `/docs/*` - Documentation pages

**Build & Deploy:**
- Build: `npm run build` in `/site`
- Output: `/site/dist`
- Deploy: GitHub Pages via `pages-deploy.yml`
- Custom domain: cyberai.network

### 5. Documentation (`/docs`)

Operator and ecosystem documentation.

**Structure:**
```
docs/
├── index.mdx                 # What is CyberAi
├── architecture.mdx          # This document
└── operators/
    ├── quickstart.mdx        # Getting started
    └── runbooks.mdx          # Operational procedures
```

**Content:**
- Real-world usage patterns
- Step-by-step guides
- Troubleshooting procedures
- Links to ecosystem repos

### 6. Workflows (`.github/workflows`)

Automated CI/CD via GitHub Actions.

**ci.yml:**
- Trigger: Push, PR
- Jobs: Run bootstrap, run audit
- Permissions: `contents: read`

**pages-deploy.yml:**
- Trigger: Push to main
- Jobs: Build site, deploy to Pages
- Permissions: `contents: read`, `pages: write`, `id-token: write`

**contracts-validate.yml:**
- Trigger: Changes to `/contracts`
- Jobs: Validate against schema, check for secrets
- Permissions: `contents: read`

## Data Flows

### 1. PR Opened

```
Developer → Push to branch
    ↓
GitHub Actions (ci.yml)
    ↓
Bootstrap & Audit
    ↓
Contract Validation
    ↓
[Pass] → Merge allowed
[Fail] → PR blocked
```

### 2. Contract Discovery

```
SmartBrain Runner
    ↓
GET github.com/SolanaRemix/CyberAi/contracts/agents/
    ↓
Parse contracts
    ↓
Load agent definitions
    ↓
Execute agents per contract
```

### 3. Agent Execution

```
Copilot Agent
    ↓
Load prompt from /prompts/agents/copilot-core/bootstrap.md
    ↓
Execute instructions
    ↓
Validate against contracts
    ↓
Report results
```

### 4. Site Deployment

```
Push to main
    ↓
GitHub Actions (pages-deploy.yml)
    ↓
Build site (npm run build)
    ↓
Upload artifact
    ↓
Deploy to GitHub Pages
    ↓
Available at cyberai.network
```

## Integration Points

### SmartBrain Runners
- Consume contracts from `/contracts/repos/smartbrain.json`
- Discover agents from `/contracts/agents/`
- Execute agents per contract definitions

### GitAntivirus
- Scans CyberAi repository per `/contracts/repos/gitantivirus.json`
- Validates contracts for security
- Audits workflows for vulnerabilities

### Copilot Agents
- Load prompts from `/prompts/agents/copilot-core/`
- Execute bootstrap and repair procedures
- Reference contracts for validation

### Terminal Mobile
- Execute bootstrap on iOS/Terminal
- Report status per `/prompts/agents/terminal-mobile/local-bootstrap.md`
- Lightweight contract validation

## Security Model

**Validation:**
- All contracts schema-validated
- Sensitive data scanning
- Workflow permission restrictions

**Permissions:**
- Minimal GitHub Actions permissions
- Explicit permission declarations
- No elevated privileges

**Audit:**
- Automated audit script
- CodeQL scanning
- Dependency vulnerability checks

**Access Control:**
- Repository-level access controls
- Protected branches
- Required reviews for contracts

## Scalability

**Horizontal:**
- Static site via CDN (GitHub Pages)
- Decentralized agent execution
- Contract registry as source of truth

**Vertical:**
- Contracts cached by consumers
- Prompts loaded on-demand
- Tools run locally

**No Central Dependencies:**
- No external APIs required
- GitHub as only dependency
- Self-contained bootstrap

## Future Extensions

- Additional contract types (runners)
- Enhanced validation rules
- Contract versioning
- Ecosystem metrics dashboard
- Real-time status monitoring

## Related Documentation

- [Operator Quickstart](/docs/operators/quickstart.mdx)
- [Operator Runbooks](/docs/operators/runbooks.mdx)
- [Contract Schema](/contracts/contract.schema.json)
- [Bootstrap Prompt](/prompts/agents/copilot-core/bootstrap.md)
